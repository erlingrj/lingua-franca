target Chisel;

reactor Counter {
    input in: {=Bool()=}
    output out: {=UInt(32.W)=}

    timer t(0, 1 msec)
    state cnt:{=UInt(32.W)=}
    state cntMode:{=Bool()=}

    reaction(in) {=
        lf_write(cntMode,lf_get(in))
    =}

    reaction(t) -> out {=
        when (lf_get(cntMode)) {
            lf_set(out, lf_read(cnt))
            lf_write(cnt, lf_read(cnt) + 1.U)
        }.otherwise {
            lf_set(out, lf_read(cnt))
            lf_write(cnt, lf_read(cnt) - 1.U)
        }
    =}
}
