target Chisel;

reactor UpCounter {
    output out: {=UInt(32.W)=}

    timer t(0, 1 msec)

    state cnt:{=UInt(32.W)=}
    reaction(t) -> out {=
        lf_set(out, lf_read(cnt))
        lf_write(cnt, lf_read(cnt) + 1.U)
    =}
}

reactor UpCounterSink {
    input in: {= UInt(32.W) =}
    state cnt:{=UInt(32.W)=}
    reaction(in) {=
        printf("Sink got %d\n", lf_get(in))
        assert(lf_get(in) === lf_read(cnt))
        lf_write(cnt, lf_read(cnt) + 1.U)
    =}

}